<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gloriaçš„AIåœ–åƒç”Ÿæˆå™¨</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700;900&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Noto Sans TC', sans-serif;
            background: linear-gradient(to right top, #3b82f6, #4f46e5, #8b5cf6, #c084fc);
            color: #f9fafb;
        }
        .main-card {
            background-color: rgba(17, 24, 39, 0.6);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        .title-text {
            text-shadow: 3px 3px 10px rgba(0, 0, 0, 0.5);
        }
        .control-label {
            font-weight: 700;
            color: #d1d5db;
            text-shadow: 1px 1px 3px rgba(0,0,0,0.3);
        }
        .form-input, .form-select {
            background-color: rgba(17, 24, 39, 0.8);
            border: 1px solid #4b5563;
            transition: all 0.2s ease-in-out;
        }
        .form-input:focus, .form-select:focus {
            --tw-ring-color: #a5b4fc;
            border-color: #a5b4fc;
        }
        .option-btn {
            border: 2px solid #4b5563;
            background-color: rgba(31, 41, 55, 0.7);
            transition: all 0.2s ease-in-out;
        }
        .option-btn.selected {
            background-color: #6366f1;
            border-color: #818cf8;
            color: white;
            font-weight: 500;
        }
        .style-btn {
            background-color: #5b21b6; /* Changed to a vibrant purple */
            transition: background-color 0.2s;
            color: white;
        }
        .style-btn:hover {
            background-color: #7c3aed;
        }
        .loader {
            width: 56px;
            height: 56px;
            border: 6px solid #FFF;
            border-bottom-color: #6366f1;
            border-radius: 50%;
            display: inline-block;
            box-sizing: border-box;
            animation: rotation 1s linear infinite;
        }
        @keyframes rotation {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        #lightbox {
            transition: opacity 0.3s ease-in-out;
        }
        #history-grid::-webkit-scrollbar {
            height: 8px;
        }
        #history-grid::-webkit-scrollbar-track {
            background: #1f2937;
            border-radius: 10px;
        }
        #history-grid::-webkit-scrollbar-thumb {
            background: #4b5563;
            border-radius: 10px;
        }
    </style>
</head>
<body class="antialiased">
    <div class="container mx-auto p-4 md:p-8 max-w-5xl">
        <header class="text-center mb-10">
            <h1 class="text-4xl md:text-6xl font-black text-white title-text">Gloriaçš„AIåœ–åƒç”Ÿæˆå™¨</h1>
            <p class="text-gray-200 mt-3 text-lg">å°‡æ‚¨çš„å¥‡æ€å¦™æƒ³ï¼Œè®Šæˆç²¾å½©çš„åœ–åƒ</p>
        </header>

        <main class="main-card p-6 md:p-8 rounded-2xl shadow-2xl space-y-8">
            <!-- 1. è¼¸å…¥æƒ³æ³• -->
            <div>
                <label for="prompt" class="block text-xl font-medium control-label mb-2">1. è¼¸å…¥æ‚¨çš„æƒ³æ³•</label>
                <textarea id="prompt" rows="3" class="w-full form-input rounded-lg p-3 focus:ring-2" placeholder="ä¾‹å¦‚ï¼šä¸€éš»æˆ´è‘—è‰å¸½çš„æŸ´çŠ¬åœ¨å‘æ—¥è‘µèŠ±ç”°è£¡è¿½é€è´è¶..."></textarea>
            </div>
            
            <!-- 2. ä¸»é¡Œé¢¨æ ¼ -->
            <div class="space-y-2">
                <label for="theme-select" class="block text-xl font-medium control-label">2. é¸æ“‡ä¸»é¡Œé¢¨æ ¼</label>
                <select id="theme-select" class="w-full form-select rounded-lg p-3">
                    <option value="">ç„¡ç‰¹å®šä¸»é¡Œ</option>
                    <option value="ï¼Œæº«é¦¨çš„æ—©å®‰åœ–">æ—©å®‰åœ–</option>
                    <option value="ï¼Œç²¾ç¾çš„ç¯€æ…¶ç¥è³€åœ–">ç¯€æ…¶ç¥è³€åœ–</option>
                    <option value="ï¼Œå‰åœåŠ›å‹•æ¼«é¢¨æ ¼">å‰åœåŠ›å‹•æ¼«</option>
                    <option value="ï¼Œå“†å•¦Aå¤¢å‹•æ¼«é¢¨æ ¼">å“†å•¦Aå¤¢å‹•æ¼«</option>
                    <option value="ï¼Œå°¼ç¾…æ²³å¥³å…’ç¶“å…¸å°‘å¥³æ¼«ç•«é¢¨æ ¼">å°¼ç¾…æ²³å¥³å…’æ¼«ç•«</option>
                    <option value="ï¼Œèå£«æ¯”äºæ­ŒåŠ‡æµ·å ±ç¾è¡“é¢¨æ ¼">èç¿æ­ŒåŠ‡æµ·å ±</option>
                    <option value="ï¼Œæ—¥ç³»å››æ ¼æ¼«ç•«é¢¨æ ¼">æ—¥ç³»å››æ ¼æ¼«ç•«</option>
                    <option value="ï¼Œæ—¥ç³»è¼•å°èªªå°é¢æ’ç•«é¢¨æ ¼">æ—¥ç³»è¼•å°èªª</option>
                    <option value="ï¼Œé›»å½±å‹•ç‰©æ–¹ç¨‹å¼è§’è‰²é¢¨æ ¼">é›»å½±å‹•ç‰©æ–¹ç¨‹å¼</option>
                    <option value="ï¼Œå¤©ç·šå¯¶å¯¶å¹¼å…’ç¯€ç›®é¢¨æ ¼">å¤©ç·šå¯¶å¯¶</option>
                    <option value="ï¼Œæµ·ç¶¿å¯¶å¯¶å¡é€šé¢¨æ ¼">æµ·ç¶¿å¯¶å¯¶</option>
                    <option value="ï¼Œä½©ä½©è±¬å¡é€šé¢¨æ ¼">ä½©ä½©è±¬</option>
                    <option value="ï¼Œæ¸…æœå®®å»·åŠ‡æœè£èˆ‡å ´æ™¯é¢¨æ ¼">æ¸…æœå®®å»·åŠ‡</option>
                    <option value="ï¼ŒéŸ“åŠ‡ç¹¼æ‰¿è€…å€‘ç¾ä»£å¶åƒåŠ‡é¢¨æ ¼">éŸ“åŠ‡ç¹¼æ‰¿è€…å€‘</option>
                </select>
            </div>

            <!-- 3. æ·»åŠ è—è¡“é¢¨æ ¼ -->
            <div class="space-y-3">
                <label class="block text-xl font-medium control-label">3. æ·»åŠ è—è¡“é¢¨æ ¼ (å¯é¸)</label>
                <div class="flex flex-wrap gap-3">
                    <button class="style-btn py-2 px-4 rounded-full" data-style="ï¼Œå‹•æ¼«é¢¨æ ¼">å‹•æ¼«é¢¨æ ¼</button>
                    <button class="style-btn py-2 px-4 rounded-full" data-style="ï¼Œæ°´å½©ç•«">æ°´å½©ç•«</button>
                    <button class="style-btn py-2 px-4 rounded-full" data-style="ï¼Œçš®å…‹æ–¯é¢¨æ ¼">çš®å…‹æ–¯</button>
                    <button class="style-btn py-2 px-4 rounded-full" data-style="ï¼ŒQç‰ˆäººç‰©">ï¼±ç‰ˆäººç‰©</button>
                    <button class="style-btn py-2 px-4 rounded-full" data-style="ï¼Œ3Då¡é€š">3Då¡é€š</button>
                    <button class="style-btn py-2 px-4 rounded-full" data-style="ï¼Œ3Dæ‹ç«‹å¾—æ•ˆæœ">3Dæ‹ç«‹å¾—</button>
                    <button class="style-btn py-2 px-4 rounded-full" data-style="ï¼Œæ¨‚é«˜ç©æœ¨é¢¨æ ¼">æ¨‚é«˜ç©æœ¨</button>
                    <button class="style-btn py-2 px-4 rounded-full" data-style="ï¼Œç›¸æ©Ÿåƒç´ é¢¨æ ¼">ç›¸æ©Ÿåƒç´ </button>
                    <button class="style-btn py-2 px-4 rounded-full" data-style="ï¼Œé›»å½±ç‰¹æ•ˆ">é›»å½±ç‰¹æ•ˆ</button>
                    <button class="style-btn py-2 px-4 rounded-full" data-style="ï¼Œæ¢µè°·ä¸–ç•Œåç•«é¢¨æ ¼">æ¢µè°·ä¸–ç•Œåç•«</button>
                </div>
            </div>

            <!-- 4. é¸æ“‡å°ºå¯¸ -->
            <div class="space-y-3">
                 <label class="block text-xl font-medium control-label">4. é¸æ“‡å°ºå¯¸</label>
                 <div id="aspect-ratio-selector" class="flex flex-wrap gap-3">
                     <button class="option-btn selected text-white py-2 px-5 rounded-lg" data-value="1:1">æ–¹å½¢ (1:1)</button>
                     <button class="option-btn text-white py-2 px-5 rounded-lg" data-value="16:9">æ©«å¼ (16:9)</button>
                     <button class="option-btn text-white py-2 px-5 rounded-lg" data-value="9:16">ç›´å¼ (9:16)</button>
                     <button class="option-btn text-white py-2 px-5 rounded-lg" data-value="9:16" data-prompt-addition="ï¼Œæ—¥ç³»å››æ ¼æ¼«ç•«(4-koma)çš„æ§‹åœ–">æ—¥ç³»4æ ¼æ¼«ç•«</button>
                 </div>
            </div>

            <!-- ç”ŸæˆæŒ‰éˆ• -->
            <button id="generate-btn" class="w-full bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-4 px-4 rounded-lg text-2xl transition-transform transform hover:scale-105 shadow-lg">
                âœ¨ é–‹å§‹ç”Ÿæˆ
            </button>

             <!-- è¨Šæ¯æç¤ºæ¡† -->
            <div id="message-box" class="hidden p-4 rounded-md text-white text-center font-semibold"></div>
        </main>

        <!-- çµæœé¡¯ç¤ºå€ -->
        <section id="result-section" class="mt-8 space-y-6 hidden">
             <!-- åŠ è¼‰å‹•ç•« -->
            <div id="loader-container" class="flex justify-center items-center h-72 main-card rounded-2xl hidden">
                <div class="text-center">
                    <div class="loader mx-auto"></div>
                    <p id="loader-text" class="mt-4 text-gray-300 text-lg">AI æ­£åœ¨å‰µä½œä¸­... è«‹ç¨å€™</p>
                </div>
            </div>
            
            <!-- åœ–ç‰‡å®¹å™¨ -->
            <div id="image-container" class="relative group hidden">
                 <img id="result-image" src="" alt="ç”Ÿæˆçš„åœ–ç‰‡" class="w-full rounded-2xl shadow-xl cursor-pointer">
                 <a id="download-btn" href="#" download="gloria-ai-art.png" class="absolute top-4 right-4 bg-black bg-opacity-50 text-white p-3 rounded-full opacity-0 group-hover:opacity-100 transition-opacity" title="ä¸‹è¼‰åœ–ç‰‡">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path><polyline points="7 10 12 15 17 10"></polyline><line x1="12" y1="15" x2="12" y2="3"></line></svg>
                 </a>
            </div>

            <!-- å„ªåŒ–å¾Œçš„ Prompt -->
            <div class="main-card p-4 rounded-2xl">
                <h3 class="text-lg font-semibold text-gray-200 mb-2">ğŸ” å„ªåŒ–å¾Œçš„è‹±æ–‡æç¤ºè© (Prompt):</h3>
                <p id="optimized-prompt-text" class="text-gray-300 font-mono text-sm bg-gray-900 p-3 rounded-md"></p>
            </div>
        </section>

         <!-- æ­·å²ç´€éŒ„ -->
        <section id="history-section" class="mt-12 hidden">
            <h2 class="text-3xl font-bold text-white mb-4 title-text">æ­·å²ç´€éŒ„</h2>
            <div id="history-grid" class="flex gap-4 overflow-x-auto pb-4">
                <!-- ç‚ºäº†ç°¡åŒ–ï¼Œæ­¤ç‰ˆæœ¬æœªå¯¦ä½œæ­·å²ç´€éŒ„åŠŸèƒ½ -->
            </div>
        </section>

    </div>

    <!-- ç‡ˆç®± -->
    <div id="lightbox" class="fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center p-4 z-50 opacity-0 pointer-events-none">
        <img id="lightbox-img" src="" class="max-w-full max-h-full rounded-lg">
        <button id="close-lightbox" class="absolute top-5 right-5 text-white text-4xl">&times;</button>
    </div>

    <script>
        // DOM å…ƒç´ 
        const promptInput = document.getElementById('prompt');
        const themeSelect = document.getElementById('theme-select');
        const styleButtons = document.querySelectorAll('.style-btn');
        const aspectRatioSelector = document.getElementById('aspect-ratio-selector');
        const generateBtn = document.getElementById('generate-btn');
        const messageBox = document.getElementById('message-box');
        
        const resultSection = document.getElementById('result-section');
        const loaderContainer = document.getElementById('loader-container');
        const loaderText = document.getElementById('loader-text');

        const imageContainer = document.getElementById('image-container');
        const resultImage = document.getElementById('result-image');
        const downloadBtn = document.getElementById('download-btn');
        
        const optimizedPromptText = document.getElementById('optimized-prompt-text');
        
        const lightbox = document.getElementById('lightbox');
        const lightboxImg = document.getElementById('lightbox-img');
        const closeLightboxBtn = document.getElementById('close-lightbox');

        /**
         * é¡¯ç¤ºæç¤ºè¨Šæ¯
         * @param {string} message - è¦é¡¯ç¤ºçš„è¨Šæ¯
         * @param {'error' | 'success' | 'info'} type - è¨Šæ¯é¡å‹
         */
        function showMessage(message, type = 'error') {
            messageBox.textContent = message;
            let bgColor = 'bg-red-600'; // error
            if (type === 'success') bgColor = 'bg-green-600';
            if (type === 'info') bgColor = 'bg-blue-600';
            messageBox.className = `p-4 rounded-md text-white text-center font-semibold ${bgColor}`;
            messageBox.classList.remove('hidden');
        }

        /**
         * ç¿»è­¯ä¸¦å„ªåŒ–æç¤ºè©
         * @param {string} originalPrompt - çµ„åˆå¾Œçš„åŸå§‹æç¤ºè©
         * @returns {Promise<string|null>} å„ªåŒ–å¾Œçš„è‹±æ–‡æç¤ºè©
         */
        async function translateAndOptimizePrompt(originalPrompt) {
            const translationPrompt = `Translate the following concept to English, then expand and enrich it to be a highly detailed and descriptive prompt for an AI image generator. The final output must be only the optimized English prompt, without any other explanatory text, introductions, or markdown formatting. Original concept: "${originalPrompt}"`;
            const payload = {
                contents: [{
                    role: "user",
                    parts: [{ text: translationPrompt }]
                }]
            };
            const apiKey = ""; // Canvas å°‡è‡ªå‹•æä¾›
            const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;

            try {
                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });
                
                const result = await response.json();

                if (!response.ok) {
                    const errorMsg = result?.error?.message || response.statusText;
                    throw new Error(`Gemini API éŒ¯èª¤: ${errorMsg}`);
                }

                if (result.promptFeedback?.blockReason) {
                    console.error("æç¤ºè©è¢«æ””æˆª:", result.promptFeedback);
                    throw new Error('æ‚¨çš„è¼¸å…¥å¯èƒ½åŒ…å«æ•æ„Ÿå…§å®¹ï¼Œå·²è¢«ç³»çµ±æ””æˆªã€‚è«‹ä¿®æ”¹å¾Œå†è©¦ã€‚');
                }
                
                const text = result?.candidates?.[0]?.content?.parts?.[0]?.text;

                if (text) {
                    return text.trim();
                } else {
                    console.error("Gemini API å›æ‡‰æ ¼å¼ä¸ç¬¦æˆ–ç‚ºç©º:", result);
                    throw new Error('ç„¡æ³•å¾ AI ç²å¾—æœ‰æ•ˆçš„å›æ‡‰ã€‚');
                }
            } catch (error) {
                console.error('ç¿»è­¯å’Œå„ªåŒ–æç¤ºè©æ™‚å‡ºéŒ¯:', error);
                showMessage(error.message || 'ç¿»è­¯æç¤ºè©æ™‚ç™¼ç”ŸæœªçŸ¥éŒ¯èª¤ï¼Œè«‹æª¢æŸ¥ç¶²è·¯é€£ç·šæˆ–ç¨å¾Œå†è©¦ã€‚');
                return null;
            }
        }
        
        /**
         * å‘¼å« Imagen API ç”Ÿæˆåœ–ç‰‡
         * @param {string} optimizedPrompt - å„ªåŒ–å¾Œçš„è‹±æ–‡æç¤ºè©
         * @param {string} aspectRatio - åœ–ç‰‡æ¯”ä¾‹
         * @returns {Promise<string|null>} Base64 ç·¨ç¢¼çš„åœ–ç‰‡è³‡æ–™æˆ– null
         */
        async function generateImageFromApi(optimizedPrompt, aspectRatio) {
            const payload = {
                instances: [{ prompt: optimizedPrompt }],
                parameters: { sampleCount: 1, aspectRatio: aspectRatio }
            };
            const apiKey = ""; // Canvas å°‡è‡ªå‹•æä¾›
            const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/imagen-3.0-generate-002:predict?key=${apiKey}`;

            try {
                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });
                
                const result = await response.json();

                if (!response.ok) {
                    const errorMsg = result?.error?.message || response.statusText;
                    throw new Error(`Imagen API éŒ¯èª¤: ${errorMsg}`);
                }

                const prediction = result.predictions?.[0];

                if (prediction?.bytesBase64Encoded) {
                    return prediction.bytesBase64Encoded;
                } else {
                    console.error("Imagen API å›æ‡‰æ ¼å¼ä¸ç¬¦æˆ–ç‚ºç©º:", result);
                    throw new Error('ç„¡æ³•å¾ AI ç²å¾—æœ‰æ•ˆçš„åœ–ç‰‡è³‡æ–™ï¼Œå¯èƒ½æ˜¯æç¤ºè©è¢«æ‹’çµ•ã€‚');
                }
            } catch (error) {
                console.error('ç”Ÿæˆåœ–ç‰‡æ™‚å‡ºéŒ¯:', error);
                showMessage(error.message || 'ç”Ÿæˆåœ–ç‰‡æ™‚ç™¼ç”ŸæœªçŸ¥éŒ¯èª¤ï¼Œè«‹æª¢æŸ¥ç¶²è·¯é€£ç·šæˆ–ä¼ºæœå™¨ç‹€æ…‹ã€‚');
                return null;
            }
        }
        
        /**
         * é–‹å•Ÿç‡ˆç®±
         * @param {string} imageUrl - è¦é¡¯ç¤ºçš„åœ–ç‰‡ URL
         */
        function openLightbox(imageUrl) {
            lightboxImg.src = imageUrl;
            lightbox.classList.remove('opacity-0', 'pointer-events-none');
        }

        /**
         * é—œé–‰ç‡ˆç®±
         */
        function closeLightbox() {
            lightbox.classList.add('opacity-0', 'pointer-events-none');
        }

        /**
         * è™•ç†ç”ŸæˆæŒ‰éˆ•é»æ“Šäº‹ä»¶
         */
        async function handleGenerateClick() {
            let fullPrompt = promptInput.value.trim();
            if (!fullPrompt) {
                showMessage('è«‹å…ˆè¼¸å…¥æ‚¨çš„æƒ³æ³•ï¼', 'error');
                return;
            }
            
            // ç²å–é¸æ“‡
            const selectedSizeButton = aspectRatioSelector.querySelector('.selected');
            const selectedAspectRatio = selectedSizeButton.dataset.value;
            const promptAddition = selectedSizeButton.dataset.promptAddition || "";

            // çµ„åˆæç¤ºè©
            fullPrompt += themeSelect.value;
            fullPrompt += promptAddition; // æ·»åŠ ä¾†è‡ªå°ºå¯¸æŒ‰éˆ•çš„é¡å¤–æç¤º
            
            // --- UI æ›´æ–° ---
            messageBox.classList.add('hidden');
            generateBtn.disabled = true;
            generateBtn.textContent = 'AI é‹ç®—ä¸­...';
            resultSection.classList.remove('hidden');
            imageContainer.classList.add('hidden');
            loaderContainer.classList.remove('hidden');
            loaderText.textContent = `AI æ­£åœ¨å‰µä½œåœ–åƒä¸­... è«‹ç¨å€™`;

            // 1. ç¿»è­¯å’Œå„ªåŒ–
            const optimizedPrompt = await translateAndOptimizePrompt(fullPrompt);
            if (!optimizedPrompt) {
                loaderContainer.classList.add('hidden');
                generateBtn.disabled = false;
                generateBtn.textContent = 'âœ¨ é–‹å§‹ç”Ÿæˆ';
                return;
            }
            optimizedPromptText.textContent = optimizedPrompt;

            // 2. ç”Ÿæˆåœ–ç‰‡
            const imageBase64 = await generateImageFromApi(optimizedPrompt, selectedAspectRatio);
            
            loaderContainer.classList.add('hidden');

            if (imageBase64) {
                const imageDataUrl = `data:image/png;base64,${imageBase64}`;
                resultImage.src = imageDataUrl;
                downloadBtn.href = imageDataUrl;
                downloadBtn.download = 'gloria-ai-art.png';
                imageContainer.classList.remove('hidden');
            }
            
            // æ¢å¾©æŒ‰éˆ•ç‹€æ…‹
            generateBtn.disabled = false;
            generateBtn.textContent = 'âœ¨ é–‹å§‹ç”Ÿæˆ';
        }

        // --- äº‹ä»¶ç›£è½å™¨ ---
        generateBtn.addEventListener('click', handleGenerateClick);

        styleButtons.forEach(button => {
            button.addEventListener('click', () => {
                promptInput.value += button.dataset.style;
                promptInput.focus();
            });
        });

        aspectRatioSelector.addEventListener('click', (e) => {
            if (e.target.tagName === 'BUTTON') {
                aspectRatioSelector.querySelectorAll('button').forEach(btn => btn.classList.remove('selected'));
                e.target.classList.add('selected');
            }
        });
        
        resultImage.addEventListener('click', () => openLightbox(resultImage.src));
        closeLightboxBtn.addEventListener('click', closeLightbox);
        lightbox.addEventListener('click', (e) => {
            if (e.target === lightbox) { // é»æ“ŠèƒŒæ™¯é—œé–‰
                closeLightbox();
            }
        });
    </script>
</body>
</html>

